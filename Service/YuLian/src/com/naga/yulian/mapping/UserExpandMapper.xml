<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.naga.yulian.dao.UserExpandMapper">
	<select id="selectUserLoginByMobile" resultType="int"
		parameterType="java.lang.String">
		select COUNT(1) from user s where s.userId =
		#{userId,jdbcType=VARCHAR}
	</select>
	<resultMap id="loadOut" type="com.naga.yulian.vo.LoadOutVo">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Mar 08 
			16:06:30 CST 2016. -->
		<result column="uuid" property="uuid" jdbcType="VARCHAR" />
		<result column="userId" property="userId" jdbcType="VARCHAR" />
		<result column="userId" property="userId" jdbcType="VARCHAR" />
		<result column="path" property="hPic" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="birthday" property="birthday" jdbcType="VARCHAR" />
		<result column="sex" property="sex" jdbcType="VARCHAR" />
		<result column="job" property="job" jdbcType="VARCHAR" />
		<result column="point" property="point" jdbcType="INTEGER" />
		<result column="currency" property="currency" jdbcType="INTEGER" />
		<result column="clas" property="clas" jdbcType="INTEGER" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
		<result column="vx" property="vx" jdbcType="VARCHAR" />
		<result column="qq" property="qq" jdbcType="VARCHAR" />
	</resultMap>
	<select id="selectUserByMobile" resultMap="loadOut"
		parameterType="com.naga.yulian.vo.LoadInVo">
		select
		u.uuid
		,u.userId
		,m.path
		,u.name
		,date_format(u.birthday,'%Y年%m月%d日') as birthday
		,case u.sex when 1
		then '男' when 2 then '女' else '不详' end as sex
		,u.job
		,u.point
		,u.currency
		,u.clas
		,u.remark
		,u.vx
		,u.qq
		from user u left join media m on
		u.uuid=m.fkid
		where u.userId = #{mobile,jdbcType=VARCHAR}
		and u.passWrod
		= #{passWord,jdbcType=VARCHAR}
	</select>
	<select id="selectUserByFace" resultMap="loadOut"
		parameterType="com.naga.yulian.vo.LoadInVo">
		select
		u.userId
		,m.path
		,u.name
		,date_format(u.birthday,'%Y年%m月%d日') as birthday
		,case u.sex when 1
		then '男' when 2 then '女' else '不详' end as sex
		,u.job
		,u.point
		,u.currency
		,u.clas
		,u.remark
		,u.vx
		,u.qq
		from user u left join media m on
		u.uuid=m.fkid
		where u.face = #{faceID,jdbcType=VARCHAR}
	</select>
	<select id="selectUserByWeChat" resultMap="loadOut"
		parameterType="com.naga.yulian.vo.FsWeChatLoadVo">
		select
		u.uuid
		,u.userId
		,m.path
		,u.name
		,date_format(u.birthday,'%Y年%m月%d日') as birthday
		,case u.sex when 1
		then '男' when 2 then '女' else '不详' end as sex
		,u.job
		,u.point
		,u.currency
		,u.clas
		,u.remark
		,u.vx
		,u.qq
		from user u left join media m on
		u.uuid=m.fkid
		where u.userId = #{openid,jdbcType=VARCHAR}
	</select>
	<update id="updatePasswordByMobile" parameterType="com.naga.yulian.vo.RegistVo">
		update user
		set
		passWrod = #{passWord,jdbcType=CHAR}
		where
		userId =
		#{mobile,jdbcType=VARCHAR}
	</update>

	<select id="selectUserByUserId" resultType="com.naga.yulian.vo.FsGetUserInfoVo"
		parameterType="java.lang.String">
		SELECT
		T1.name AS NAME,
		T1.sex AS sex,
		T1.job AS job,
		T1.clas AS clas,
		IFNULL(T3.myScore,'0') AS POINT,
		IFNULL(T1.currency,'0') AS currency,
		IFNULL(T1.face,'false') AS face,
		T2.path AS hPic,
		T1.uuId as uuid
		FROM USER T1
		LEFT JOIN media T2 ON T1.uuid =
		T2.fkId
		LEFT JOIN score T3 ON T1.uuid =
		T3.fkId
		WHERE T1.userId =
		#{userId}
	</select>

	<!--获取用户个人信息 -->
	<select id="selectUserInfoByUserId" resultType="com.naga.yulian.vo.FsGetUserInfoVo"
		parameterType="java.lang.String">
		SELECT
		T1.name AS NAME,
		T1.sex AS sex,
		T1.job AS job,
		T1.clas AS clas,
		IFNULL(T3.myScore,'0') AS POINT,
		IFNULL(T1.currency,'0') AS currency,
		IFNULL(T1.face,'false') AS face,
		T2.path AS hPic,
		T1.uuId
		FROM USER T1
		LEFT JOIN media T2 ON T1.uuid =
		T2.fkId
		LEFT JOIN score T3 ON T1.uuid =
		T3.fkId
		WHERE T1.uuId =
		#{uuId}
	</select>

	<!--编辑用户个人信息 -->
	<update id="editUserInfoByUserId" parameterType="com.naga.yulian.entity.User">
		update user set
		<if test="sex!=null">
			sex = #{sex},
		</if>
		<if test="name!=null">
			name = #{name},
		</if>
		latitude = #{latitude},
		longitude = #{longitude}
		where userId =
		#{userid}
	</update>
	
	<!--编辑用户个人信息 -->
	<update id="editUserInfoByUuId" parameterType="com.naga.yulian.entity.User">
		update user set
		<if test="sex!=null">
			sex = #{sex},
		</if>
		<if test="name!=null">
			name = #{name},
		</if>
		latitude = #{latitude},
		longitude = #{longitude}
		where uuId =
		#{userid}
	</update>
</mapper>